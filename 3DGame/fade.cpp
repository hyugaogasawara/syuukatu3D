//=============================================================================
//
// フェード処理 [fade.cpp]
// Author : 小笠原　彪我
//
//=============================================================================
//=============================================================================
//インクルードファイル
//=============================================================================
#include "fade.h"
#include "manager.h"
#include "game.h"

//=============================================================================
// 静的メンバ変数宣言
//=============================================================================

//=============================================================================
// コンストラクタ
//=============================================================================
CFade::CFade(int nPriority) : CScene2D(nPriority)
{
	m_fade = FADE_NONE;
	m_color = D3DXCOLOR(0.0f, 0.0f, 0.0f, 0.0f);
}
//=============================================================================
// デストラクタ
//=============================================================================
CFade::~CFade()
{
}
//=============================================================================
// 初期化処理
//=============================================================================
HRESULT CFade::Init(void)
{
	m_fade = FADE_IN;
	m_color = D3DXCOLOR(0.0f, 0.0f, 0.0f, 1.0f);
	CScene2D::Init();

	return S_OK;
}
//=============================================================================
// 終了処理
//=============================================================================
void CFade::Uninit(void)
{
	CScene2D::Uninit();
}
//=============================================================================
// 更新処理
//=============================================================================
void CFade::Update(void)
{
	if (m_fade != FADE_NONE)
	{
		if (m_fade == FADE_IN)
		{
			m_color.a -= 0.05f;
			if (m_color.a <= 0.0f)
			{
				m_color.a = 0.0f;
				m_fade = FADE_NONE;
			}
		}
		else if (m_fade == FADE_OUT)
		{
			m_color.a += 0.05f;
			if (m_color.a >= 1.0f)
			{
				m_color.a = 1.0f;
				m_fade = FADE_IN;

				//モードの設定
				CManager::SetMode(m_modeNext);
			}
		}
		CScene2D::SetColor(m_color);
	}

	if (m_bUninit == true)
	{
		Uninit();
	}
}
//=============================================================================
// 描画処理
//=============================================================================
void CFade::Draw(void)
{
	CScene2D::Draw();
}

//=============================================================================
// フェードを生成
//=============================================================================
CFade *CFade::Create(CManager::MODE mode)
{
	CFade *pFade = NULL;

	pFade = new CFade;
	if (pFade != NULL)
	{
		pFade->SetSize(D3DXVECTOR3(SCREEN_WIDTH, SCREEN_HEIGHT, 0.0f));
		pFade->SetPosition(D3DXVECTOR3(SCREEN_CENTER_X, SCREEN_CENTER_Y, 0.0f));
		pFade->Init();
		pFade->m_fade = FADE_OUT;
		pFade->m_modeNext = mode;
		pFade->m_color = D3DXCOLOR(0.0f, 0.0f, 0.0f, 0.0f);
	}
	return pFade;
}
//=============================================================================
// フェード設定
//=============================================================================
void CFade::SetFade(CManager::MODE modenext)
{
	m_fade = FADE_OUT;
	m_modeNext = modenext;
	m_color = D3DXCOLOR(0.0f, 0.0f, 0.0f, 0.0f);
}